package com.news.newshunt;

import android.app.Notification;
import android.app.NotificationManager;
import android.app.PendingIntent;
import android.content.Context;
import android.content.Intent;
import android.os.Bundle;
import android.util.Log;

import com.google.gson.Gson;
import com.news.newshunt.constants.Conatants;
import com.news.newshunt.pojo.ContentOfNews;
import com.news.newshunt.pojo.Newscontent;
import com.parse.ParsePushBroadcastReceiver;

public class PushDataReceiver extends ParsePushBroadcastReceiver {
	
	ContentOfNews contentOfNews;


	@Override
	protected void onPushReceive(Context context, Intent intent) {
		super.onPushReceive(context, intent);
		try
		{
		Bundle bundle = intent.getExtras() ;
		String jsonData = bundle.getString("com.parse.Data") ;
		Gson gson = new Gson();
		System.out.println(jsonData + "         crep");
		contentOfNews = gson.fromJson(jsonData, ContentOfNews.class);
		
		Newscontent  newscontent = contentOfNews.getNewscontent().get(0) ;
		
		Intent intent2 = new Intent(context, NotificationActivity.class) ;
		intent2.putExtra(Conatants.NEWS_CONTENT, newscontent.getContent()) ;
		intent2.putExtra(Conatants.NEWS_IMAGE_LINK, newscontent.getImagelink()) ;
		intent2.putExtra(Conatants.NEWS_HEADLINE, newscontent.getHeadlines()) ;
		intent2.putExtra(Conatants.NEWS_DATE, newscontent.getNewstime()) ;

		PendingIntent pIntent = PendingIntent.getActivity(context, 0, intent2, PendingIntent.FLAG_UPDATE_CURRENT);

		
		Notification n  = new Notification.Builder(context)
        .setContentTitle("New mail from " + "test@gmail.com")
        .setContentText("Subject")
        .setSmallIcon(R.drawable.news)
        .setContentIntent(pIntent)
        .setAutoCancel(true)
       .build();
		
		NotificationManager notificationmanager = (NotificationManager) context
				.getSystemService(Context.NOTIFICATION_SERVICE);
		// Build Notification with Notification Manager
		notificationmanager.notify(0, n);
    
		
		Log.e("in broadcast receiver",jsonData) ;
		}
		catch(Exception exception)
		{
			Log.d("PushDataReceiver", "PushDataReceiver Eception") ;
		}
	}
	
	

}
